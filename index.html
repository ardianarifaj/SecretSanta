<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Secret Santa</title>

  <!-- Mobile viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <!-- iPhone web app -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Secret Santa" />
  <meta name="theme-color" content="#4f46e5" />

  <!-- ‚úÖ iPhone icon (must exist in repo root with EXACT name) -->
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="icon" href="apple-touch-icon.png" />

  <style>
    :root { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #ffe9e9, #f5f7fb);
      padding: 1.5rem;
    }

    .app {
      width: 100%;
      max-width: 900px;
      background: #fff;
      border-radius: 1.5rem;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.18);
      padding: 1.75rem 1.75rem 2rem;
    }

    @media (min-width: 768px) { .app { padding: 2rem 2.25rem 2.5rem; } }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .app-title {
      font-size: 1.7rem;
      font-weight: 700;
      color: #111827;
      display: flex;
      align-items: center;
      gap: .5rem;
    }

    .app-title .emoji { font-size: 1.9rem; }
    .app-subtitle { color: #6b7280; font-size: 0.95rem; margin-top: 0.25rem; }

    .pill {
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      background: #f3f4ff;
      color: #4f46e5;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
    @media (min-width: 768px) { .grid { grid-template-columns: 1.1fr 0.9fr; gap: 1.75rem; } }

    .card {
      border-radius: 1.2rem;
      border: 1px solid #e5e7eb;
      padding: 1.1rem 1.2rem 1.2rem;
      background: #f9fafb;
    }

    .card-header { display: flex; justify-content: space-between; align-items: center; gap: .5rem; margin-bottom: .75rem; }
    .card-title { font-size: 0.95rem; font-weight: 600; color: #111827; }
    .card-hint { font-size: 0.8rem; color: #9ca3af; }

    label { display:block; font-size:.85rem; font-weight:500; color:#4b5563; margin-bottom:.4rem; }
    textarea {
      width:100%;
      border-radius:.75rem;
      border:1px solid #d1d5db;
      padding:.75rem .85rem;
      min-height:160px;
      resize:vertical;
      font-size:.9rem;
      font-family:inherit;
      background:#fff;
    }
    textarea::placeholder { color:#9ca3af; }

    .help-text { font-size:.8rem; color:#9ca3af; margin-top:.25rem; }

    .btn-row { display:flex; flex-wrap:wrap; gap:.75rem; margin-top:1rem; align-items:center; }
    button {
      border-radius:999px;
      border:none;
      padding:.6rem 1.3rem;
      font-size:.9rem;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      transition: transform .08s ease, box-shadow .08s ease, background .15s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color:#fff;
      box-shadow: 0 8px 20px rgba(79, 70, 229, 0.35);
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow:0 12px 26px rgba(79,70,229,.45); }
    .btn-secondary { background:#e5e7eb; color:#374151; }
    .btn-secondary:hover { background:#d1d5db; }
    .btn-ghost { background:transparent; color:#6b7280; padding-inline:0; box-shadow:none; }
    .btn-ghost:hover { color:#374151; transform:none; }

    .status { font-size:.85rem; color:#6b7280; }
    .status.error { color:#b91c1c; }

    .results-card {
      border-radius: 1.2rem;
      border: 1px solid #e5e7eb;
      padding: 1.1rem 1.2rem 1.25rem;
      background: #fff;
    }

    .results-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:.75rem; gap:.5rem; }
    .results-title { font-size:.95rem; font-weight:600; color:#111827; display:flex; align-items:center; gap:.4rem; }
    .results-title .icon { font-size:1.1rem; }

    .results-list { margin:0; padding:0; list-style:none; display:grid; gap:.4rem; font-size:.9rem; }
    .result-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:.75rem;
      padding:.45rem .65rem;
      border-radius:.75rem;
      background:#f9fafb;
      border:1px solid #e5e7eb;
    }
    .result-name { font-weight:500; color:#111827; }
    .arrow { font-size:.9rem; color:#9ca3af; white-space:nowrap; }
    .result-target { font-weight:500; color:#4f46e5; }

    .results-empty { font-size:.85rem; color:#9ca3af; font-style:italic; }

    .footer {
      margin-top:1.25rem;
      font-size:.75rem;
      color:#9ca3af;
      display:flex;
      justify-content:space-between;
      gap:.75rem;
      flex-wrap:wrap;
      align-items:center;
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="app-header">
      <div>
        <div class="app-title"><span class="emoji">üéÖüèº</span><span>Secret Santa</span></div>
        <p class="app-subtitle">Paste names, add ‚Äúdo not match‚Äù rules, and generate instantly.</p>
      </div>
      <div class="pill">Runs locally</div>
    </header>

    <main class="grid">
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Participants</div>
            <div class="card-hint">One name per line. At least 3 people.</div>
          </div>
        </div>

        <label for="names">Names</label>
        <textarea id="names" placeholder="Anna
Ben
Clara
David"></textarea>
        <div class="help-text">Use the same spelling in forbidden pairs.</div>

        <div style="margin-top:1rem"></div>

        <div class="card-header">
          <div>
            <div class="card-title">Forbidden pairs (optional)</div>
            <div class="card-hint">Prevent partners / specific pairs.</div>
          </div>
        </div>

        <label for="banned">Do not match (giver,receiver)</label>
        <textarea id="banned" placeholder="Anna,Ben
Clara,David"></textarea>
        <div class="help-text">Example: ‚ÄúAnna,Ben‚Äù means Anna cannot get Ben.</div>

        <div class="btn-row">
          <button class="btn-primary" id="generateBtn">üéÅ Generate</button>
          <button class="btn-secondary" id="clearBtn">Clear</button>
          <span id="status" class="status"></span>
        </div>
      </section>

      <section class="results-card">
        <div class="results-header">
          <div class="results-title"><span class="icon">‚ú®</span><span>Assignments</span></div>
          <div class="btn-row" style="margin:0;">
            <button class="btn-ghost" id="reshuffleBtn" style="display:none;">üîÑ Reshuffle</button>
            <button class="btn-ghost" id="copyBtn" style="display:none;">üìã Copy</button>
          </div>
        </div>

        <div id="resultsContainer">
          <p class="results-empty">No matches yet. Add names and tap ‚ÄúGenerate‚Äù.</p>
        </div>
      </section>
    </main>

    <footer class="footer">
      <span>Nothing is uploaded ‚Äî it runs in your browser.</span>
      <span>Tip: re-add to Home Screen after icon changes.</span>
    </footer>
  </div>

  <script>
    function parseNames(raw) {
      return raw.split('\n').map(s => s.trim()).filter(Boolean);
    }

    function parseBannedPairs(raw) {
      const banned = new Set();
      for (const line of raw.split('\n')) {
        const t = line.trim();
        if (!t) continue;
        const parts = t.split(',');
        if (parts.length !== 2) continue;
        const giver = parts[0].trim();
        const receiver = parts[1].trim();
        if (!giver || !receiver) continue;
        banned.add(giver + '‚Üí' + receiver);
      }
      return banned;
    }

    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function generateAssignments(names, bannedPairs, maxAttempts = 5000) {
      if (names.length < 3) throw new Error('You need at least 3 participants.');

      const sorted = names.slice().sort((a, b) => a.localeCompare(b));
      const n = sorted.length;

      for (let attempt = 0; attempt < maxAttempts; attempt++) {
        const receivers = shuffle(sorted);
        let ok = true;

        for (let i = 0; i < n; i++) {
          const giver = sorted[i];
          const receiver = receivers[i];
          if (giver === receiver) { ok = false; break; }
          if (bannedPairs.has(giver + '‚Üí' + receiver)) { ok = false; break; }
        }

        if (ok) return sorted.map((giver, i) => ({ giver, receiver: receivers[i] }));
      }

      throw new Error('No valid match found. Remove some forbidden pairs or add more people.');
    }

    const namesEl = document.getElementById('names');
    const bannedEl = document.getElementById('banned');
    const generateBtn = document.getElementById('generateBtn');
    const clearBtn = document.getElementById('clearBtn');
    const statusEl = document.getElementById('status');
    const resultsContainer = document.getElementById('resultsContainer');
    const reshuffleBtn = document.getElementById('reshuffleBtn');
    const copyBtn = document.getElementById('copyBtn');

    let lastNames = [];
    let lastBanned = null;
    let lastAssignments = null;

    function showStatus(msg, isErr=false) {
      statusEl.textContent = msg || '';
      statusEl.classList.toggle('error', !!isErr);
    }

    function render(assignments) {
      if (!assignments || assignments.length === 0) {
        resultsContainer.innerHTML = '<p class="results-empty">No matches yet. Add names and tap ‚ÄúGenerate‚Äù.</p>';
        reshuffleBtn.style.display = 'none';
        copyBtn.style.display = 'none';
        return;
      }

      const ul = document.createElement('ul');
      ul.className = 'results-list';

      for (const p of assignments) {
        const li = document.createElement('li');
        li.className = 'result-row';

        const a = document.createElement('span');
        a.className = 'result-name';
        a.textContent = p.giver;

        const arrow = document.createElement('span');
        arrow.className = 'arrow';
        arrow.textContent = '‚Üí';

        const b = document.createElement('span');
        b.className = 'result-target';
        b.textContent = p.receiver;

        li.appendChild(a); li.appendChild(arrow); li.appendChild(b);
        ul.appendChild(li);
      }

      resultsContainer.innerHTML = '';
      resultsContainer.appendChild(ul);
      reshuffleBtn.style.display = 'inline-flex';
      copyBtn.style.display = 'inline-flex';
    }

    generateBtn.addEventListener('click', () => {
      showStatus('');

      const names = parseNames(namesEl.value);
      const banned = parseBannedPairs(bannedEl.value);

      for (const n of names) banned.add(n + '‚Üí' + n);

      try {
        const assignments = generateAssignments(names, banned);
        lastNames = names;
        lastBanned = banned;
        lastAssignments = assignments;
        render(assignments);
        showStatus('Assignments generated ‚úî');
      } catch (e) {
        lastAssignments = null;
        render(null);
        showStatus(e.message, true);
      }
    });

    reshuffleBtn.addEventListener('click', () => {
      if (!lastNames.length || !lastBanned) return;
      try {
        const assignments = generateAssignments(lastNames, lastBanned);
        lastAssignments = assignments;
        render(assignments);
        showStatus('Reshuffled ‚úî');
      } catch (e) {
        showStatus(e.message, true);
      }
    });

    copyBtn.addEventListener('click', async () => {
      if (!lastAssignments) return;
      const text = lastAssignments.map(p => `${p.giver} ‚Üí ${p.receiver}`).join('\n');
      try {
        await navigator.clipboard.writeText(text);
        showStatus('Copied ‚úî');
      } catch {
        showStatus('Could not copy.', true);
      }
    });

    clearBtn.addEventListener('click', () => {
      namesEl.value = '';
      bannedEl.value = '';
      lastNames = [];
      lastBanned = null;
      lastAssignments = null;
      render(null);
      showStatus('');
    });
  </script>
</body>
</html>
